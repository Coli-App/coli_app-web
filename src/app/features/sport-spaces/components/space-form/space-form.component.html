<div class="space-form-dialog">
  <div class="dialog-header">
    <h2 class="text-xl font-semibold text-gray-900 mb-1">
      {{ data.mode === 'edit' ? 'Editar Espacio Deportivo' : 'Nuevo Espacio Deportivo' }}
    </h2>
    <p class="text-sm text-gray-600">
      {{ data.mode === 'edit' ? 'Actualiza la información del espacio deportivo' : 'Completa la información para crear un nuevo espacio deportivo' }}
    </p>
  </div>

  <form [formGroup]="spaceForm" class="dialog-content">
    <!-- Space Name Input -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Nombre del espacio</mat-label>
      <input matInput formControlName="name" placeholder="Ej: Cancha de Fútbol Principal">
      <mat-icon matPrefix>label</mat-icon>
      @if (spaceForm.get('name')?.invalid && spaceForm.get('name')?.touched) {
      <mat-error>{{ getErrorMessage('name') }}</mat-error>
      }
    </mat-form-field>

    <!-- Space Location -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Ubicación del espacio</mat-label>
      <input matInput formControlName="location" placeholder="Ej: Sector Norte, Edificio Deportes">
      <mat-icon matPrefix>location_on</mat-icon>
      @if (spaceForm.get('location')?.invalid && spaceForm.get('location')?.touched) {
      <mat-error>{{ getErrorMessage('location') }}</mat-error>
      }
    </mat-form-field>

    <!-- Space Description -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Descripción</mat-label>
      <textarea matInput formControlName="description" rows="3"
        placeholder="Describe las características del espacio"></textarea>
      <mat-icon matPrefix>description</mat-icon>
      @if (spaceForm.get('description')?.invalid && spaceForm.get('description')?.touched) {
      <mat-error>{{ getErrorMessage('description') }}</mat-error>
      }
    </mat-form-field>

    <!-- Space Capacity -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Capacidad (personas)</mat-label>
      <input matInput type="number" formControlName="capacity" placeholder="Ej: 50">
      <mat-icon matPrefix>group</mat-icon>
      @if (spaceForm.get('capacity')?.invalid && spaceForm.get('capacity')?.touched) {
      <mat-error>{{ getErrorMessage('capacity') }}</mat-error>
      }
    </mat-form-field>

    <!-- File Upload with Drag & Drop -->
    <div class="file-upload-section">
      <label class="file-upload-label">Imagen del espacio</label>
      <app-file-picker
        [accept]="'image/*'"
        [maxSize]="5242880"
        [placeholder]="'Arrastra una imagen aquí o haz clic para seleccionar'"
        [hint]="'PNG, JPG hasta 5MB'"
        [required]="true"
        [disabled]="loading()"
        (fileSelected)="onFileSelected($event)"
        (fileRemoved)="onFileRemoved()">
      </app-file-picker>
      @if (spaceForm.get('image')?.invalid && spaceForm.get('image')?.touched) {
      <span class="error-text">La imagen es requerida</span>
      }
    </div>

    <!-- Available Sports -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Deportes disponibles</mat-label>
      <mat-icon matPrefix>sports_soccer</mat-icon>
      <mat-select formControlName="sportIds" multiple>
        @for (sport of availableSports(); track sport.id) {
        <mat-option [value]="sport.id">
          {{ sport.name }}
        </mat-option>
        }
      </mat-select>

      @if (spaceForm.get('sportIds')?.invalid && spaceForm.get('sportIds')?.touched) {
      <mat-error>{{ getErrorMessage('sportIds') }}</mat-error>
      }
    </mat-form-field>

    <!-- Status active/inactive -->
    <div class="toggle-container">
      <mat-slide-toggle formControlName="state" color="primary">
        <span class="toggle-label">
          <mat-icon>{{ spaceForm.get('state')?.value ? 'check_circle' : 'cancel' }}</mat-icon>
          {{ spaceForm.get('state')?.value ? 'Espacio Activo' : 'Espacio Inactivo' }}
        </span>
      </mat-slide-toggle>
    </div>

    <!-- Schedule Configuration Button -->
    @if (data.mode === 'create') {
    <div class="schedule-section">
      <label class="schedule-label">
        <mat-icon>schedule</mat-icon>
        Horario de disponibilidad *
      </label>
      <button
        mat-raised-button
        type="button"
        class="schedule-button"
        (click)="openScheduleModal()"
        [disabled]="loading()">
        <mat-icon>{{ scheduleConfigured() ? 'edit_calendar' : 'add_circle' }}</mat-icon>
        {{ scheduleConfigured() ? 'Modificar Horario' : 'Definir Horario' }}
      </button>
      <div class="schedule-info" [class.configured]="scheduleConfigured()">
        <mat-icon>{{ scheduleConfigured() ? 'check_circle' : 'info' }}</mat-icon>
        <span>{{ getScheduleSummary() }}</span>
      </div>
    </div>
    }
  </form>

  <div class="dialog-actions">
    <button mat-button type="button" (click)="onCancel()" [disabled]="loading()">
      Cancelar
    </button>

    <button mat-raised-button color="primary" type="submit" (click)="onSubmit()"
      [disabled]="loading() || spaceForm.invalid" class="bg-[#1DC48F] hover:bg-[#17a87a]">
      @if (loading()) {
      <mat-spinner diameter="20" class="mr-2"></mat-spinner>
      } @else {
      <mat-icon>{{ data.mode === 'edit' ? 'save' : 'add' }}</mat-icon>
      }
      {{ loading() ? 'Guardando...' : (data.mode === 'edit' ? 'Actualizar Espacio' : 'Crear Espacio') }}
    </button>
  </div>
</div>
